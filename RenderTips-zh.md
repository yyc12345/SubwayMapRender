# Render Tips

本文档旨在提供一些使用本程序渲染地铁图的建议。本程序专门用于Minecraft中的地铁线路图构建，又因为Minecraft中的地铁大多仿制现实中的地铁，因此本文档就现实中的地铁规划问题做出一些问题的回答和建议推荐

## 不建议使用的字符

此章节所述的不建议使用的字符指的是：线路的名称和站台ID这两个属性中不宜使用的字符

* `-`：渲染过程中程序会使用`-`字符在类名的定义中，此外，各类名称中的空白也将被转换为`-`，使用`-`字符会造成一些不必要的名称混乱
* `.`：HTML中的类选择器字符，使用此字符会导致CSS文档含义错乱
* `,`，`#`：程序的某些处理过程依赖这两个符号作为标记
* `"`：你想输入也输入不进去，这个字符在命令行中非法，且不能通过转义字符`\"`输入
* 一些UTF-8字符（例如CJK）：不清楚你的终端是否支持输入这些字符，当然如果不支持你也可以用`import`指令从文件输入这些字符，这些字符可以用，列在这只是起提醒作用

## 坐标系变换

## 坐标部分

输出的地图的格式是向上为北，俯视地图。

如果您使用真实坐标来创建渲染图，我们会按照Minecraft中的坐标系将其映射在屏幕直角坐标系中：向右为X正向，向下为Z轴正向，垂直屏幕沿纸外方向是Y轴正向

如果您使用相对坐标来创建渲染图，我们会按照屏幕直角坐标系直接映射：向右为X正向，向下为Y轴正向，**垂直屏幕沿纸外方向是Z轴正向**

## 旋转角部分

对于每一个站台，我们会有一个旋转角，用于指定站台的说明文字将位于这个站点的何处。

我们会首先计算当前站台所拥有的所有换乘点的几何中心，然后在此点建立数学上常用的二维直角坐标系：向右为X正向，向上为Y轴正向。

旋转角定义在这个坐标系中且和我们平时的数学一致。从X轴正向开始逆时针旋转，从0度到360度。其中，当旋转角的可变边（与此相对的是固定在X轴正向上的不变边）处于X轴正向范围内时，站台字符左对齐向右输出，处于X轴负向范围内时，站台字符右对齐左向输出。

## 节点类型

节点分为具有附加站台属性的节点和普通节点。

普通节点一般用于转折，构建线路形状之中。

具有附加站台属性的节点用于标识当前位置是一个站台，一旦将其设置为具有附加站台属性的节点，则意味着该节点将纳入该站台的换乘计数以及换乘绘制当中。

## 线路节点坐标和站台坐标

本程序数据结构中，线路每个节点的坐标和站台坐标是分开描述的，分开了具有附加站台属性的节点的坐标和站台坐标。具有附加站台属性的节点坐标指示站台的位置，而站台坐标指示车站入口或者车站大厅的位置。

建议：

* 将站台中点作为具有附加站台属性的节点的坐标
* 将站厅或者车站入口的坐标作为站台坐标，也可以方便玩家tp
* 线路图在渲染的时候，将站台坐标单独做圆，然后所有具有附加站台属性的节点的坐标做圆后直线连接到站台坐标上

## 我的线路图好~~JB~~丑

本程序是按坐标直接输出位置，不会做任何优化处理，请准确踩点，确保踩点的统一性，例如我们给出的建议：

* 统一以轨道方块所在位置为轨道Y坐标
* 对于单数轨宽的线路，以中线为坐标
* 对于双数轨宽的线路，以中线靠东或南的线路为坐标
* 勤拐点，在X,Z数值出现波动的时候就立即做个拐点，以避免出现车站间直线连接（除非本来就是直线连接的）
* 待补充。。。

## 附属线路

附属线路是我将以下线路进行的统称，由于程序设计上只允许节点列表~~一条黑走到底~~只能有一条，且不能分叉，因此做此功能来弥补缺陷。

一条线路可被多条线路附属，但一条线路只能属于一个线路的附属。附属是展示层面的，在输出结果中的显示设置中，各个支线不会单独产生单独显示按钮，而是会与主线路共享一个按钮，一同显示与隐藏。同样，在线路中单击线路也会显示主线路而不是附属线路的名称（上述选项可通过渲染配置关闭与开启。~~什么？你要单独配置每一条线路的功能？没有，再见。~~）

### 如何实现支线

我们知道，线路中有时候会出现支线，实现支线也是我们需要关注的。本程序原理上不支持支线，但是你可以用一些特殊的技巧来解决这个问题。

一条支线，一定与主线有一定的连接，那么我们可以将支线看为一个独立的线路，与其他线路的交汇点正常地按照换乘站处理。然后与主线的连接视为连接点，这些连接点根据你的情况可以设置为具有附加站台属性的节点（你想让主线与支线在此处标识为换乘）又或者是普通节点（你只想让线路从这出去）

唯一的遗憾就是支线的名称不能与主线相同（当然你可以通过加空格来强行假装相同），因为程序要求所有线路的名称必须是唯一的。

### 如何实现混线/混联

有时候你的线路图会设计出一个线路的车会跑到另一条线路上。这也是可以实现的。由于本程序不是运行模拟器，因此只要拼出来像就完全OK了。将两条线路各自引出一条支线，然后在你混联的切换线路经过的路径上选择一个合适的点（通常是中点），然后将线路都接到那个点上就OK了。注意要按照普通节点接上去，并且无需在这个点设置站台（除非你这里真的有站，不过有站的话也就不算混联了吧，可以等价为两条线路一个终点站的模型了）

## 如何实现环线

环线即首尾相接的线路。首先你需要选择一个起点，通常是拥有大分支，大换乘站又或者是车辆段的点，然后按一定方向进行节点创建，在节点列表的末尾创建一个普通节点，使之与初始节点坐标相同即可。

## 如何实现曲线

**警告：此章节的内容暂未实现，本程序暂时未实现曲率功能，请不要阅读，以免产生误解**

线路有时候是不规则的，由于本程序是为Minecraft这种方块类型的游戏的地铁图打造的，因此对这方面处理较少，但是也是可以实现的。

以90度圆弧拐角为例，您可以在线路不规则部分左右各取一个点，具体则是圆弧与直线的切点。然后在序号较为靠前的点的Following属性中设置曲率即可。曲率的不同决定了曲线的形状，通过设置合适的数值就能得到同样的效果。

那么不规则铁路的？建议：使用圆弧近似，然后分区段设置曲率，尽量模拟就好。

那么圆形铁轨呢？比如莫斯科地铁的环线，又或者HanamiCraft里的环线？Emm。。。还是圆弧近似吧，各个节点之间分别设置曲率，尽量模拟。

